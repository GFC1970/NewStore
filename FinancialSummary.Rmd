---
title: "New Store"
author: "Graham Cox"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

```{r setup, echo=FALSE, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```
```{r warnings = FALSE, results="hide", message=FALSE, echo=FALSE, include=FALSE}
library(knitr)
library(kableExtra)
source("data-prepare.R")
source("summary-plots.R")
```

<style type="text/css">
body * {font-family:Roboto Condensed}
p {font-size:14pt}
h1 {font-size:30pt;color:white;background:#4682B4;padding:7px}
h2 {font-weight:700;border-bottom:2px solid #4682B4;padding:5px}
table thead th { border-bottom: 2px solid #4682B4; }
th, td { padding: 7px; }
<!-- thead, tfoot, tr:nth-child(even) { background: #eee; } -->
</style>

## Financial Summary

A total revenue of £`r scales::comma(sum(data_tbl$total_revenue))` has been received since `r format(min(data_tbl$order_date), "%d %b %Y")`. Current year revenue is £ `r scales::comma(sum(data_tbl$total_revenue[data_tbl$order_date >= as.Date("2020-01-01")]))`.

```{r echo=FALSE, include=TRUE, out.width="90%"}

data_tbl %>% 
  mutate(Year = order_date %>% year()) %>% 
  group_by(Year) %>% 
  summarise(revenue = sum(total_revenue), 
            units = sum(order_units),
            cogs = sum(total_cogs),
            profit = revenue - cogs, .groups = "drop") %>% 
  mutate(revenue = paste0("\u00A3", scales::comma(revenue)),
         units = scales::comma(units),
         cogs = paste0("\u00A3", scales::comma(cogs)),
         profit = paste0("\u00A3", scales::comma(profit))) %>% 
  kable(align = c("l", "r", "r", "r", "r"), caption = "Total Revenue by Year", col.names = c("Year", "Revenue", "Units", "Cost of Goods", "Profit")) %>% 
  kable_styling(bootstrap_options = "striped", full_width = FALSE, position = "left") %>% 
  column_spec(c(2, 5), bold = TRUE) %>% 
  column_spec(3:4, italic = TRUE) %>% 
  column_spec(2:5, width = "20%")

```




```{r annual_plot, echo=FALSE, fig.width=10, fig.height=6}
annual_revenue_plot

```

### Monthly Revenue by Year

```{r monthly_plot, echo=FALSE, fig.width=12, fig.height=8}
annual_monthly_revenue_plot
```


# Appendix 1 - Session information
```{r sessionInfo}
sessionInfo()
```
